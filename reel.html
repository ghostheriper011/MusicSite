<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reels</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ===== RESET ===== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
body {
  font-family: Arial, sans-serif;
  background: #000;
  color: white;
  overflow: hidden;
}

/* ===== NAVBAR ===== */
nav {
  position: fixed;
  top: 0;
  width: 100%;
  height: 55px;
  background: #111;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
  z-index: 999;
}
nav a {
  color: white;
  text-decoration: none;
  margin: 0 10px;
  font-weight: bold;
}
nav a:hover {
  color: #ff2d55;
}

/* ===== REELS SCROLL CONTAINER ===== */
#wrap {
  margin-top: 55px;
  height: calc(100vh - 55px);
  overflow-y: scroll;
  scroll-snap-type: y mandatory;
  scroll-behavior: smooth;
}

/* ===== INDIVIDUAL REEL ===== */
.reel {
  height: 100%;
  width: 100%;
  position: relative;
  scroll-snap-align: start;
  display: flex;
  justify-content: center;
  align-items: center;
  background: black;
}
.reel video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  cursor: pointer;
}

/* ===== FLOATING HEART ANIMATION ===== */
.heart {
  position: absolute;
  font-size: 80px;
  color: #ff2d55;
  transform: scale(0);
  animation: pop 0.8s forwards;
  pointer-events: none;
}
@keyframes pop {
  0% { transform: scale(0); opacity: 1; }
  50% { transform: scale(1.3); opacity: 1; }
  100% { transform: scale(1); opacity: 0; }
}

/* ===== SIDE BUTTONS ===== */
.side {
  position: absolute;
  right: 12px;
  bottom: 120px;
  display: flex;
  flex-direction: column;
  gap: 18px;
  font-size: 24px;
}
.side button {
  background: none;
  border: none;
  color: white;
  font-size: 24px;
  cursor: pointer;
}
.likeBtn.liked {
  color: #ff2d55;
  transform: scale(1.2);
}

/* ===== COMMENTS PANEL ===== */
.commentPanel {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  background: #111;
  max-height: 45%;
  display: none;
  flex-direction: column;
  padding: 10px;
}
.commentList {
  flex: 1;
  overflow-y: auto;
  font-size: 14px;
  margin-bottom: 8px;
}
.commentItem {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 4px;
}
.commentItem span {
  flex: 1;
}
.commentItem button {
  background: none;
  border: none;
  color: #ff2d55;
  cursor: pointer;
  margin-left: 6px;
  font-size: 14px;
}
.commentInput {
  display: flex;
  gap: 5px;
}
.commentInput input {
  flex: 1;
  padding: 8px;
  border: none;
  border-radius: 6px;
}
.commentInput button {
  padding: 8px 12px;
  border: none;
  border-radius: 6px;
  background: #ff2d55;
  color: white;
  cursor: pointer;
}

/* ===== UPLOAD BUTTON ===== */
#uploadFloat {
  position: fixed;
  right: 14px;
  bottom: 90px;
  width: 42px;
  height: 42px;
  border-radius: 50%;
  font-size: 20px;
  background: #ff2d55;
  color: white;
  border: none;
  cursor: pointer;
  z-index: 1000;
  opacity: 0.85;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}
#uploadFloat:hover {
  opacity: 1;
  transform: scale(1.08);
}

/* ===== POPUP ===== */
#popup {
  position: fixed;
  bottom: 150px;
  left: 50%;
  transform: translateX(-50%);
  background: #222;
  padding: 10px 18px;
  border-radius: 20px;
  display: none;
}
</style>
</head>
<body>

<!-- NAVBAR -->
<nav>
  <div>MyReels</div>
  <div>
    <a href="index.html">Home</a>
    <a href="music.html">Music</a>
  </div>
</nav>

<!-- REELS CONTAINER -->
<div id="wrap"></div>

<!-- UPLOAD BUTTON -->
<input type="file" id="fileInput" accept="video/*" hidden>
<button id="uploadFloat">Ôºã</button>

<!-- POPUP -->
<div id="popup"></div>

<script>
/* ===== STORAGE ===== */
let reels = JSON.parse(localStorage.getItem("reels") || "[]");
const wrap = document.getElementById("wrap");

/* ===== POPUP FUNCTION ===== */
function popup(msg) {
  const p = document.getElementById("popup");
  p.innerText = msg;
  p.style.display = "block";
  setTimeout(() => p.style.display = "none", 1400);
}

/* ===== BUILD REELS ===== */
function build() {
  wrap.innerHTML = "";

  reels.forEach((r, i) => {
    const reel = document.createElement("div");
    reel.className = "reel";

    // Create video once per reel
    if (!r.videoEl) {
      const video = document.createElement("video");
      video.src = r.src;
      video.controls = true;
      video.loop = true;
      video.playsInline = true;
      r.videoEl = video;

      // DOUBLE-TAP HEART
      let lastTap = 0;
      video.addEventListener("click", () => {
        const now = Date.now();
        if (now - lastTap < 300) {
          r.liked = true;
          localStorage.setItem("reels", JSON.stringify(reels));
          likeBtn.innerText = "‚ù§Ô∏è";
          showHeart(video);
        }
        lastTap = now;
      });
    }
    reel.appendChild(r.videoEl);

    /* ===== SIDE BUTTONS ===== */
    const side = document.createElement("div");
    side.className = "side";
    side.innerHTML = `
      <button class="likeBtn">${r.liked ? "‚ù§Ô∏è" : "ü§ç"}</button>
      <button class="commentBtn">üí¨</button>
      <button class="delBtn">üóëÔ∏è</button>
    `;
    reel.appendChild(side);
    const likeBtn = side.querySelector(".likeBtn");

    /* ===== COMMENT PANEL ===== */
    const panel = document.createElement("div");
    panel.className = "commentPanel";
    panel.innerHTML = `
      <div class="commentList"></div>
      <div class="commentInput">
        <input placeholder="Comment...">
        <button>Post</button>
      </div>
    `;
    reel.appendChild(panel);
    const commentList = panel.querySelector(".commentList");

    const renderComments = () => {
      commentList.innerHTML = (r.comments || []).map((c, idx) => `
        <div class="commentItem">
          <span>${c}</span>
          <button class="editBtn" data-id="${idx}">‚úèÔ∏è</button>
          <button class="delCommentBtn" data-id="${idx}">üóëÔ∏è</button>
        </div>
      `).join("");
    };
    renderComments();

    /* ===== BUTTON FUNCTIONALITY ===== */
    likeBtn.onclick = () => {
      r.liked = !r.liked;
      localStorage.setItem("reels", JSON.stringify(reels));
      likeBtn.innerText = r.liked ? "‚ù§Ô∏è" : "ü§ç";
      popup(r.liked ? "‚ù§Ô∏è Liked" : "Like removed");
    };

    side.querySelector(".delBtn").onclick = () => {
      reels.splice(i, 1);
      localStorage.setItem("reels", JSON.stringify(reels));
      build();
      popup("Deleted");
    };

    side.querySelector(".commentBtn").onclick = () => {
      panel.style.display = panel.style.display === "flex" ? "none" : "flex";
      panel.style.flexDirection = "column";
    };

    panel.querySelector(".commentInput button").onclick = () => {
      const input = panel.querySelector("input");
      if (!input.value.trim()) return;
      r.comments = r.comments || [];
      r.comments.push(input.value);
      localStorage.setItem("reels", JSON.stringify(reels));
      input.value = "";
      renderComments();
    };

    panel.addEventListener("click", e => {
      if (e.target.classList.contains("delCommentBtn")) {
        const idx = e.target.dataset.id;
        r.comments.splice(idx, 1);
        localStorage.setItem("reels", JSON.stringify(reels));
        renderComments();
      }
      if (e.target.classList.contains("editBtn")) {
        const idx = e.target.dataset.id;
        const newC = prompt("Edit comment:", r.comments[idx]);
        if (newC !== null) {
          r.comments[idx] = newC;
          localStorage.setItem("reels", JSON.stringify(reels));
          renderComments();
        }
      }
    });

    wrap.appendChild(reel);
  });

  observeVideos();
}

/* ===== FLOATING HEART ===== */
function showHeart(video) {
  const heart = document.createElement("div");
  heart.className = "heart";
  heart.style.left = "50%";
  heart.style.top = "50%";
  heart.style.transform = "translate(-50%,-50%) scale(0)";
  video.parentElement.appendChild(heart);
  setTimeout(() => heart.remove(), 800);
}

/* ===== AUTO PLAY ON SCROLL WITH RESET ===== */
function observeVideos() {
  const obs = new IntersectionObserver(entries => {
    entries.forEach(e => {
      const v = e.target.querySelector("video");
      if (e.isIntersecting) {
        v.currentTime = 0; // reset video
        v.play();
      } else {
        v.pause();
      }
    });
  }, { threshold: 0.7 });

  document.querySelectorAll(".reel").forEach(r => obs.observe(r));
}

/* ===== INITIAL BUILD ===== */
build();

/* ===== UPLOAD ===== */
const uploadBtn = document.getElementById("uploadFloat");
const fileInput = document.getElementById("fileInput");

uploadBtn.onclick = () => fileInput.click();

fileInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  const url = URL.createObjectURL(file);
  reels.unshift({ src: url, liked: false, comments: [], date: Date.now() });
  localStorage.setItem("reels", JSON.stringify(reels));
  build();
  popup("Uploaded");
};

/* ===== DRAGGABLE UPLOAD BUTTON ===== */
let isDragging = false, offsetX = 0, offsetY = 0;

uploadBtn.addEventListener("mousedown", e => {
  isDragging = true;
  offsetX = e.clientX - uploadBtn.offsetLeft;
  offsetY = e.clientY - uploadBtn.offsetTop;
});
document.addEventListener("mousemove", e => {
  if (!isDragging) return;
  uploadBtn.style.left = (e.clientX - offsetX) + "px";
  uploadBtn.style.top = (e.clientY - offsetY) + "px";
});
document.addEventListener("mouseup", () => isDragging = false);

uploadBtn.addEventListener("touchstart", e => {
  isDragging = true;
  const t = e.touches[0];
  offsetX = t.clientX - uploadBtn.offsetLeft;
  offsetY = t.clientY - uploadBtn.offsetTop;
});
document.addEventListener("touchmove", e => {
  if (!isDragging) return;
  const t = e.touches[0];
  uploadBtn.style.left = (t.clientX - offsetX) + "px";
  uploadBtn.style.top = (t.clientY - offsetY) + "px";
});
document.addEventListener("touchend", () => isDragging = false);

</script>
</body>
</html>